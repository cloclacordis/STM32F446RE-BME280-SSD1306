@startuml

skinparam backgroundColor #F6FBFB
skinparam shadowing true
skinparam roundcorner 12
skinparam defaultFontName "Arial"
skinparam defaultFontSize 12
skinparam ArrowColor #5FA38F
skinparam componentStyle rectangle

[*] --> INIT : Power On
INIT --> IDLE : Init OK
INIT --> ERROR : Init Failed

IDLE --> READ_SENSOR : Timer Expired (5 s)

READ_SENSOR --> READ_SENSOR : Transient Error / Retry < 3
READ_SENSOR --> UPDATE_DISPLAY : Data Ready
READ_SENSOR --> ERROR : Retry >= 3

UPDATE_DISPLAY --> UPDATE_DISPLAY : Transient Error / Retry < 2
UPDATE_DISPLAY --> IDLE : Display Updated
UPDATE_DISPLAY --> ERROR : Retry >= 2

ERROR --> IDLE : Error Recovered
ERROR --> [*] : Fatal Error

note bottom of ERROR
  Log via UART. Attempt I2C bus recovery.
  If unrecoverable -> Display "Err", Watchdog reset to INIT.
end note

@enduml
